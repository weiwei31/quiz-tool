<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³‡å®‰æ•™è‚²è¨“ç·´å°è€ƒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .choice-input:checked + .choice-box {
            border-color: #26C6B6 !important;
            background-color: rgba(38, 198, 182, 0.05);
            color: #1a8e82;
        }
        .choice-input:checked + .choice-box .radio-dot {
            background-color: #26C6B6;
            border-color: #26C6B6;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #26C6B6;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-50 min-h-screen py-12 px-4 font-sans text-slate-700">
    <div class="max-w-2xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-slate-800 tracking-tight">è³‡å®‰æ•™è‚²è¨“ç·´å°è€ƒ</h1>
            <p class="text-slate-500 mt-3 text-lg">æˆ‘æœƒè€ƒä¸€ç™¾åˆ†~æä¸å¥½ä¸€ç™¾å¤šåˆ† </p>
        </header>

        <div id="login-section" class="bg-white shadow-xl shadow-slate-200/50 rounded-3xl p-10 text-center transition-all">
            <div class="mb-6">
                <label class="block text-sm font-medium text-slate-500 mb-2">è«‹è¼¸å…¥ä½ çš„å§“å</label>
                <input type="text" id="userName" placeholder="ä¾‹å¦‚ï¼šæ±Ÿå¯¶" 
                    class="w-full px-5 py-4 bg-slate-50 border-2 border-slate-100 rounded-2xl focus:ring-4 focus:ring-[#26C6B6]/20 focus:border-[#26C6B6] outline-none transition-all text-center text-xl font-bold">
            </div>
            <button id="start-btn" onclick="startQuiz()" class="w-full bg-[#26C6B6] hover:bg-[#1fb3a4] text-white font-bold py-4 rounded-2xl shadow-lg shadow-[#26C6B6]/30 transition-all flex items-center justify-center space-x-2">
                <span id="btn-text">æˆ‘æº–å‚™å¥½äº†ï¼Œé–‹å§‹å§ï¼</span>
                <div id="btn-spinner" class="loading-spinner hidden" style="width: 20px; height: 20px; border-width: 2px;"></div>
            </button>
        </div>

        <div id="quiz-section" class="hidden">
            <div id="questions-container" class="space-y-6 mb-8"></div>
            <button onclick="submitQuiz()" id="submit-btn" 
                class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-5 rounded-3xl shadow-xl transition-all active:scale-[0.98]">
                æˆ‘å¯«å®Œäº†ï¼Œè¦äº¤åˆ¸
            </button>
        </div>

        <div id="result-section" class="hidden bg-white shadow-2xl rounded-[2.5rem] p-12 text-center border-t-8 border-[#26C6B6]">
            <div class="inline-flex items-center justify-center w-24 h-24 bg-[#26C6B6]/10 rounded-full mb-6 text-5xl">ğŸ†</div>
            <h2 class="text-2xl font-bold text-slate-800 mb-2">æ¸¬é©—å®Œæˆï¼</h2>
            <p class="text-slate-500 mb-6 text-lg"><span id="display-name" class="text-slate-800 font-bold"></span>ï¼Œä½ çš„å¾—åˆ†æ˜¯</p>
            <div class="text-8xl font-black text-[#26C6B6] mb-8" id="final-score">0</div>
            <p class="text-sm text-slate-400">åˆ†æ•¸å·²è‡ªå‹•åŒæ­¥è‡³é›²ç«¯ï¼Œç¨å¾Œæœƒå…¬å¸ƒå¤§å®¶çš„æˆç¸¾ï¼</p>
        </div>
    </div>

    <script>
        // 1. å¡«å…¥ç¶²å€
        const scriptURL = 'https://script.google.com/macros/s/AKfycbw_r6EwgODpVudjvbHIzfjw64SSlCcNZrHRks6ZpD7shctFkKiaCwhDVoAfl9n5RRA7hA/exec';
        
        let questionsData = [];
        let userName = "";

        async function startQuiz() {
            userName = document.getElementById('userName').value.trim();
            if (!userName) return alert("è«‹è¼¸å…¥å§“åï¼");

            const startBtn = document.getElementById('start-btn');
            const btnText = document.getElementById('btn-text');
            const btnSpinner = document.getElementById('btn-spinner');
            
            startBtn.disabled = true;
            btnText.innerText = "æ­£åœ¨è¼‰å…¥è€ƒå·å…§å®¹...";
            btnSpinner.classList.remove('hidden');

            try {
                const response = await fetch(scriptURL);
                questionsData = await response.json();
                renderQuestions();
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('quiz-section').classList.remove('hidden');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } catch (error) {
                console.error(error);
                alert("æŠ“å–å¤±æ•—ï¼Œè«‹ç¢ºèª Apps Script æ¬Šé™è¨­ç‚ºã€Œæ‰€æœ‰äººã€ã€‚");
                startBtn.disabled = false;
                btnText.innerText = "å†è©¦ä¸€æ¬¡";
                btnSpinner.classList.add('hidden');
            }
        }

        function renderQuestions() {
            const container = document.getElementById('questions-container');
            container.innerHTML = "";
            questionsData.forEach((q, index) => {
                const isBonus = String(q.IsBonus).toLowerCase() === 'yes';
                const qCard = document.createElement('div');
                qCard.className = "bg-white shadow-md shadow-slate-200/60 rounded-3xl p-8 border border-slate-50 relative overflow-hidden";
                const bonusTag = isBonus ? `<div class="absolute top-0 right-0 bg-orange-400 text-white text-[10px] font-bold px-4 py-1 rounded-bl-xl uppercase tracking-widest shadow-sm">åŠ åˆ†é¡Œ +5pt</div>` : '';
                qCard.innerHTML = `${bonusTag}
                    <div class="flex items-start mb-6">
                        <span class="bg-slate-100 text-slate-500 font-bold px-3 py-1 rounded-lg text-sm mr-3">Q${index + 1}</span>
                        <h3 class="text-xl font-bold text-slate-800 leading-snug">${q.Question}</h3>
                    </div>
                    <div class="grid gap-3">
                        ${['A', 'B', 'C', 'D'].map(opt => {
                            if(!q['Option' + opt]) return '';
                            return `<label class="relative cursor-pointer">
                                <input type="radio" name="q${index}" value="${opt}" class="hidden choice-input">
                                <div class="choice-box flex items-center px-6 py-4 border-2 border-slate-100 rounded-2xl hover:bg-slate-50 hover:border-slate-200 transition-all">
                                    <div class="radio-dot w-4 h-4 rounded-full border-2 border-slate-300 mr-4 transition-all"></div>
                                    <span class="text-lg font-medium">${q['Option' + opt]}</span>
                                </div>
                            </label>`;
                        }).join('')}
                    </div>`;
                container.appendChild(qCard);
            });
        }

        async function submitQuiz() {
            const btn = document.getElementById('submit-btn');
            btn.disabled = true;
            btn.innerText = "äº¤åˆ¸ä¸­...";
            let totalScore = 0;
            let userAnswers = {};
            const normalQs = questionsData.filter(q => String(q.IsBonus).toLowerCase() !== 'yes');
            const scorePerNormal = normalQs.length > 0 ? 100 / normalQs.length : 0;

            questionsData.forEach((q, index) => {
                const sel = document.querySelector(`input[name="q${index}"]:checked`);
                const ans = sel ? sel.value : "";
                userAnswers[`Q${index+1}`] = ans;
                if (ans === q.Answer) totalScore += (String(q.IsBonus).toLowerCase() === 'yes' ? 5 : scorePerNormal);
            });

            try {
                await fetch(scriptURL, { method: 'POST', body: JSON.stringify({ name: userName, score: Math.round(totalScore), answers: userAnswers }) });
                document.getElementById('quiz-section').classList.add('hidden');
                document.getElementById('result-section').classList.remove('hidden');
                document.getElementById('display-name').innerText = userName;
                document.getElementById('final-score').innerText = Math.round(totalScore);
            } catch (e) { alert("ä¸Šå‚³å¤±æ•—"); btn.disabled = false; }
        }
    </script>
</body>
</html>
